(()=>{const e=document.querySelector("#createNewChar"),t=document.querySelector("#image"),a=document.querySelector("#name"),r=document.querySelector("#shortDescription"),o=document.querySelector("#description"),n=document.querySelector(".displayImage"),c=document.getElementById("image"),s=sessionStorage.getItem("selectedCharacterId");window.addEventListener("load",(async()=>{const e=await fetch(`https://character-database.becode.xyz/characters/${s}`),t=await e.json();n.style.backgroundImage=`url(data:image/png;base64,${t.image})`,(async()=>{if(null!==s){const e=(await axios.get(`https://character-database.becode.xyz/characters/${s}`)).data;a.value=e.name,r.value=e.shortDescription,o.value=e.description}else a.value="",r.value="",o.value=""})()})),t.addEventListener("change",(()=>{i(t)}));const i=async e=>{const t=e.files[0];if(t){if(t.type&&!t.type.startsWith("image/"))throw new Error("File is not an image.");return new Promise(((e,a)=>{const r=new FileReader;r.onload=t=>{n.style.backgroundImage=`url(${t.target.result})`,e(n.style.backgroundImage.split(",")[1])},r.onerror=()=>{a(new Error("Error occurred while reading the file."))},r.readAsDataURL(t)}))}return n.style.backgroundImage.split(",")[1]},l=async()=>{const t=new FormData(e),a=Object.fromEntries(t);if(null===s)try{const e=await i(c);a.image=e}catch(e){console.error(e)}return a};e.addEventListener("submit",(async e=>{if(e.preventDefault(),null!==s){const e=await l(),t=await i(c);e.image=t;try{const e=await l(),t=await i(c);e.image=t;const a=await fetch(`https://character-database.becode.xyz/characters/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(a.ok){const e=await a.data;console.log(e),window.location.href="../../dist/index.html"}}catch(e){console.log(`There has been an error: ${e}`)}}else{const e=await l();try{const t=await fetch("https://character-database.becode.xyz/characters",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.ok){const e=await t.json();console.log(e),window.location.href="../../dist/index.html"}}catch(e){console.log(`There has been an error, ${e}!`)}}}))})();